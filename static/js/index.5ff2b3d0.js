(()=>{"use strict";var e={4139:function(e,r,n){var t,o,l=n(6773),i=n(1699),a=n(8511),s=n(2189),u=n(3237),c=n(9751),d=n(5213),f=n(2369),p=((t={}).GRASS="GRASS",t.RIVER="RIVER",t.MOUNTAIN="MOUNTAIN",t.DIRT="DIRT",t.TREE="TREE",t.FARM="FARM",t.FARM_WITH_RICE="FARM_WITH_RICE",t.CAMPFIRE="CAMPFIRE",t.WALL="WALL",t.BRIDGE="BRIDGE",t.WORKBENCH="WORKBENCH",t);let y={CAMPFIRE:{name:"Campfire",cost:{WOOD:2},type:p.CAMPFIRE,description:"Used to cook food."},WALL:{name:"Wall",cost:{WOOD:1,STONE:1},type:p.WALL,description:"Protects from enemies."},BRIDGE:{name:"Bridge",cost:{WOOD:3},type:p.BRIDGE,description:"Allows crossing rivers."},WORKBENCH:{name:"Workbench",cost:{WOOD:4,STONE:4,IRON:1},type:p.WORKBENCH,description:"Used to craft weapons."}},h=(e,r)=>{for(let n in r)if(!(n in e)||e[n]<r[n])return!1;return!0},R=(e,r)=>{let n={...e};for(let e in r)n[e]-=r[e],0===n[e]&&delete n[e];return n},x=(e,r,n)=>{let{map:t,player:o}=e,l=y[r];if(!l)return console.error(`Structure "${r}" not found.`),null;if(!h(o.inventory,l.cost))return console.warn(`Not enough resources to build ${r}`),null;if(n.x<0||n.x>=t[0].length||n.y<0||n.y>=t.length)return console.warn("Can't build out of map"),null;let i=t[n.y][n.x];if("BRIDGE"===r&&i!==p.RIVER)return console.warn("Can only build a bridge on a river."),null;if("BRIDGE"!==r&&i!==p.GRASS)return console.warn("Can't build here"),null;let a=R(o.inventory,l.cost),s=[...t];return s[n.y][n.x]=l.type,{...e,map:s,player:{...o,inventory:a}}},E=(e,r)=>{let{map:n,player:t}=e,o=n[r.y][r.x];if(o!==p.CAMPFIRE&&o!==p.WALL&&o!==p.BRIDGE&&o!==p.WORKBENCH)return console.warn("Can't demolish here"),null;let l=Object.values(y).find(e=>e.type===o);if(!l)return console.warn("Structure not found."),null;let i=[...n];i[r.y][r.x]=p.GRASS;let a={...t.inventory};for(let e in l.cost)a[e]=(a[e]||0)+l.cost[e];return{...e,map:i,player:{...t,inventory:a}}},m=e=>{let{map:r,player:n}=e;if(n.energy<5)return console.warn("Not enough energy to dig ground"),null;let t={...n,energy:n.energy-5},o=[...r];return o[n.position.y][n.position.x]===p.GRASS?(o[n.position.y][n.position.x]=p.FARM,{...e,player:t,map:o}):(console.warn("Cannot dig ground here"),null)},g=e=>{let{map:r,player:n}=e,t=r[n.position.y][n.position.x],o={[p.GRASS]:{WOOD:5},[p.MOUNTAIN]:{STONE:5,IRON:.1},[p.TREE]:{WOOD:5},[p.FARM]:{RICE:5},[p.FARM_WITH_RICE]:{RICE:5}};if(n.energy<5)return console.warn("Not enough energy to gather resources."),null;let l=null,i=null;if(t===p.FARM||t===p.FARM_WITH_RICE)l=t,i={x:n.position.x,y:n.position.y};else if(t!==p.TREE&&t!==p.MOUNTAIN)for(let e=-1;e<=1;e++){for(let t=-1;t<=1;t++){if(0===t&&0===e)continue;let o=n.position.x+t,a=n.position.y+e;if(o>=0&&o<r[0].length&&a>=0&&a<r.length){if(r[a][o]===p.TREE){l=p.TREE,i={x:o,y:a};break}if(r[a][o]===p.MOUNTAIN){l=p.MOUNTAIN,i={x:o,y:a};break}}}if(l)break}else l=t,i={x:n.position.x,y:n.position.y};if(!l)return console.warn("Cannot gather resources here."),null;if(!o[l])return console.warn("Cannot gather resources from this tile."),null;let a={...n,energy:n.energy-5},s={};for(let e in o[l])"IRON"===e&&Math.random()>o[l][e]||("IRON"!==e?s[e]=o[l][e]:s[e]=(s[e]||0)+1);for(let e in s)a.inventory[e]=(a.inventory[e]||0)+s[e];let u=[...r];return(l===p.TREE||l===p.MOUNTAIN)&&(u[i.y][i.x]=p.GRASS),{...e,player:a,map:u}},I=(e,r,n,t)=>{e.preventDefault(),t({mouseX:e.clientX-2,mouseY:e.clientY-4,x:r,y:n})},b=e=>{e(null)},O=(e,r,n,t)=>{if(!n)return;let{x:o,y:l}=n,i=null;switch(e){case"gather":i=g(r);break;case"dig":i=m(r);break;case"build_campfire":i=x(r,"CAMPFIRE",{x:o,y:l});break;case"build_wall":i=x(r,"WALL",{x:o,y:l});break;case"build_bridge":i=x(r,"BRIDGE",{x:o,y:l});break;case"build_workbench":i=x(r,"WORKBENCH",{x:o,y:l});break;case"demolish":i=E(r,{x:o,y:l})}i&&t(i)},v=(e,r,n)=>{let{position:t}=n.player,o=Math.abs(e-t.x),l=Math.abs(r-t.y);return o<=1&&0===l||0===o&&l<=1},A=(e,r,n)=>{if(!n)return!1;let{x:t,y:o}=n,{position:l}=r.player;return e===p.TREE||e===p.MOUNTAIN?(()=>{for(let e=-1;e<=1;e++)for(let n=-1;n<=1;n++){if(0===n&&0===e)continue;let i=l.x+n,a=l.y+e;if(i>=0&&i<r.map[0].length&&a>=0&&a<r.map.length&&(r.map[a][i]===p.TREE||r.map[a][i]===p.MOUNTAIN)&&t===i&&o===a)return!0}return!1})():(e===p.FARM||e===p.FARM_WITH_RICE)&&l.x===t&&l.y===o},C=e=>e===p.CAMPFIRE||e===p.WALL||e===p.BRIDGE||e===p.WORKBENCH;var M=n(3438);class S{add(e){this.x+=e.x,this.y+=e.y}constructor(e,r){(0,M._)(this,"_x",void 0),(0,M._)(this,"_y",void 0),(0,M._)(this,"x",void 0),(0,M._)(this,"y",void 0),this._x=e,this._y=r,this.x=e,this.y=r}}let N=(e,r)=>{let{map:n,player:t}=e;if(r.x>=0&&r.x<30&&r.y>=0&&r.y<30){let o=n[r.y][r.x];if(o!==p.RIVER&&o!==p.MOUNTAIN&&o!==p.TREE&&o!==p.WALL&&o!==p.WORKBENCH)return{...e,player:{...t,position:new S(r.x,r.y)}}}return null},_=e=>{let r=setInterval(()=>{e(e=>({...e,timeCycle:e.timeCycle+1,player:{...e.player,hunger:e.player.hunger-1,energy:e.player.energy-2}}))},1e4);return()=>clearInterval(r)},T=()=>{let e=Array(30).fill(null).map(()=>Array(30).fill(p.GRASS));return(()=>{let r=[Math.floor(30*Math.random()),29],[n,t]=[Math.floor(30*Math.random()),0];for(;n!==r[0]||t!==r[1];)e[t][n]=p.RIVER,.5>Math.random()?n+=n<r[0]?1:-1:t+=t<r[1]?1:-1})(),(()=>{for(let r=0;r<5;r++){let r=Math.floor(30*Math.random()),n=Math.floor(30*Math.random());for(let t=-1;t<=1;t++)for(let o=-1;o<=1;o++){let l=r+o,i=n+t;l>=0&&l<30&&i>=0&&i<30&&(e[i][l]=p.MOUNTAIN)}}})(),(()=>{for(let r=0;r<40;r++){let r=Math.floor(30*Math.random()),n=Math.floor(30*Math.random());e[n][r]===p.GRASS&&(e[n][r]=p.TREE)}})(),console.log("map",e),e},j=e=>{let r=localStorage.getItem("gameState");e(r?JSON.parse(r):e=>({...e,map:T()}))},W=(e,r)=>{r.current?r.current=!1:localStorage.setItem("gameState",JSON.stringify(e))},k={fists:{name:"Fists",description:"Обычные кулаки",value:0,type:((o={}).SWORD="SWORD",o.FISTS="FISTS",o).FISTS,damage:2,range:1}},w={display:"flex",justifyContent:"space-around",alignItems:"center",backgroundColor:"#f0f0f0",padding:"10px",marginBottom:"10px",borderBottom:"1px solid #ccc"},B={border:"1px solid #000",backgroundColor:"#fff",width:"fit-content",margin:"0 auto",userSelect:"none",outline:"none","&:focus":{outline:"none"}},F={width:"20px",height:"20px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",position:"relative"},D={position:"absolute",top:"2px",left:"2px",fontSize:"18px",zIndex:10},G={GRASS:"#90EE90",RIVER:"#6495ED",MOUNTAIN:"#808080",DIRT:"#8B4513",TREE:"#90EE90",FARM:"#DEB887",FARM_WITH_RICE:"#8FBC8F",CAMPFIRE:"#FFA500",WALL:"#A9A9A9",BRIDGE:"#8B4513",WORKBENCH:"#778899"},L={TREE:"\uD83C\uDF32",FARM:"\uD83C\uDF3E",FARM_WITH_RICE:"\uD83C\uDF5A",CAMPFIRE:"\uD83D\uDD25",WALL:"\uD83E\uDDF1",BRIDGE:"\uD83C\uDF09",WORKBENCH:"\uD83D\uDEE0️"},P=()=>{let e={map:[],player:{position:new S(15,15),name:"Player",maxHealth:50,health:50,maxHunger:100,hunger:100,maxEnergy:100,energy:100,inventory:{},gold:0,equippedWeapon:k.fists},timeCycle:0},[r,n]=(0,i.useState)(e),t=(0,i.useRef)(!0),[o,a]=(0,i.useState)(null),[s,y]=(0,i.useState)(null);return(0,i.useEffect)(()=>{j(n)},[]),(0,i.useEffect)(()=>{W(r,t)},[r]),(0,i.useEffect)(()=>_(n),[]),(0,l.jsxs)(u.Z,{children:[(0,l.jsxs)(u.Z,{sx:w,children:[(0,l.jsxs)("div",{children:["Здоровье: ",r.player.health]}),(0,l.jsxs)("div",{children:["Голод: ",r.player.hunger]}),(0,l.jsxs)("div",{children:["Энергия: ",r.player.energy]}),(0,l.jsxs)("div",{children:["Дерево: ",r.player.inventory.WOOD||0]}),(0,l.jsxs)("div",{children:["Камень: ",r.player.inventory.STONE||0]}),(0,l.jsxs)("div",{children:["Железо: ",r.player.inventory.IRON||0]}),(0,l.jsxs)("div",{children:["Рис: ",r.player.inventory.RICE||0]})]}),(0,l.jsx)(c.Z,{onClick:()=>{localStorage.removeItem("gameState"),n({...e,map:T()})},children:"New Game"}),(0,l.jsx)(u.Z,{tabIndex:0,onKeyDown:e=>{let{position:t}=r.player,o=t.x,l=t.y;switch(e.key){case"w":l--;break;case"s":l++;break;case"a":o--;break;case"d":o++;break;default:return}let i=N(r,new S(o,l));i&&n(i)},sx:{...B,display:"grid",gridTemplateColumns:"repeat(30, 20px)"},children:r.map.map((e,n)=>e.map((e,t)=>(0,l.jsxs)(u.Z,{sx:{...F,backgroundColor:G[e],"&::before":{content:'""',position:"absolute",width:"100%",height:"100%",zIndex:1e3,border:(null==o?void 0:o.x)===t&&o.y===n?"1px solid red":"none"}},onContextMenu:e=>I(e,t,n,y),onMouseEnter:()=>a({x:t,y:n}),onMouseLeave:()=>a(null),children:[L[e]&&(0,l.jsx)("div",{children:L[e]}),r.player.position.x===t&&r.player.position.y===n&&(0,l.jsx)(u.Z,{sx:D,children:"\uD83E\uDDD1‍\uD83C\uDF3E"})]},`${t}-${n}`)))}),s&&(0,l.jsxs)(d.Z,{open:null!==s,onClose:()=>b(y),anchorReference:"anchorPosition",anchorPosition:null!==s?{top:s.mouseY,left:s.mouseX}:void 0,children:[A(r.map[s.y][s.x],r,s)&&(0,l.jsx)(f.Z,{onClick:()=>O("gather",r,s,n),children:"Gather"}),r.map[s.y][s.x]===p.GRASS&&(0,l.jsx)(f.Z,{onClick:()=>O("dig",r,s,n),children:"Dig Ground"}),v(s.x,s.y,r)&&[(0,l.jsx)(f.Z,{onClick:()=>O("build_campfire",r,s,n),children:"Build Campfire"},"build_campfire"),(0,l.jsx)(f.Z,{onClick:()=>O("build_wall",r,s,n),children:"Build Wall"},"build_wall"),r.map[s.y][s.x]===p.RIVER&&(0,l.jsx)(f.Z,{onClick:()=>O("build_bridge",r,s,n),children:"Build Bridge"},"build_bridge"),(0,l.jsx)(f.Z,{onClick:()=>O("build_workbench",r,s,n),children:"Build Workbench"},"build_workbench")],C(r.map[s.y][s.x])&&(0,l.jsx)(f.Z,{onClick:()=>O("demolish",r,s,n),children:"Demolish"})]})]})};var H=n(6851),Z=n(552);let U=(0,H.Z)((0,Z.Z)({typography:{htmlFontSize:16}})),K=document.getElementById("root");K&&a.createRoot(K).render((0,l.jsx)(i.StrictMode,{children:(0,l.jsx)(()=>(0,l.jsx)(s.Z,{theme:U,children:(0,l.jsx)(P,{})}),{})}))}},r={};function n(t){var o=r[t];if(void 0!==o)return o.exports;var l=r[t]={exports:{}};return e[t](l,l.exports,n),l.exports}n.m=e,n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,{a:r}),r},(()=>{var e,r=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};n.t=function(t,o){if(1&o&&(t=this(t)),8&o||"object"==typeof t&&t&&(4&o&&t.__esModule||16&o&&"function"==typeof t.then))return t;var l=Object.create(null);n.r(l);var i={};e=e||[null,r({}),r([]),r(r)];for(var a=2&o&&t;"object"==typeof a&&!~e.indexOf(a);a=r(a))Object.getOwnPropertyNames(a).forEach(function(e){i[e]=function(){return t[e]}});return i.default=function(){return t},n.d(l,i),l}})(),n.d=function(e,r){for(var t in r)n.o(r,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];n.O=function(r,t,o,l){if(t){l=l||0;for(var i=e.length;i>0&&e[i-1][2]>l;i--)e[i]=e[i-1];e[i]=[t,o,l];return}for(var a=1/0,i=0;i<e.length;i++){for(var t=e[i][0],o=e[i][1],l=e[i][2],s=!0,u=0;u<t.length;u++)(!1&l||a>=l)&&Object.keys(n.O).every(function(e){return n.O[e](t[u])})?t.splice(u--,1):(s=!1,l<a&&(a=l));if(s){e.splice(i--,1);var c=o();void 0!==c&&(r=c)}}return r}})(),n.rv=function(){return"1.2.3"},(()=>{var e={980:0};n.O.j=function(r){return 0===e[r]};var r=function(r,t){var o,l,i=t[0],a=t[1],s=t[2],u=0;if(i.some(function(r){return 0!==e[r]})){for(o in a)n.o(a,o)&&(n.m[o]=a[o]);if(s)var c=s(n)}for(r&&r(t);u<i.length;u++)l=i[u],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(c)},t=self.webpackChunkrsbuild_react_ts=self.webpackChunkrsbuild_react_ts||[];t.forEach(r.bind(null,0)),t.push=r.bind(null,t.push.bind(t))})(),n.ruid="bundler=rspack@1.2.3";var t=n.O(void 0,["869","361","747"],function(){return n(4139)});t=n.O(t)})();